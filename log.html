<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ë£°ë › ê¸°ë¡</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { 
  getAuth, 
  createUserWithEmailAndPassword, 
  signInWithEmailAndPassword,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { 
  getFirestore, 
  collection, 
  getDocs,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCgVETP2TbQOkDeh5D2ocwXhUMPcZYYKbs",
  authDomain: "roulette-b5455.firebaseapp.com",
  projectId: "roulette-b5455",
  storageBucket: "roulette-b5455.firebasestorage.app",
  messagingSenderId: "728191308035",
  appId: "1:728191308035:web:b14b46c38bbe0261969936"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.signup = async function(){
  const email = document.getElementById("email").value;
  const pw = document.getElementById("pw").value;
  await createUserWithEmailAndPassword(auth, email, pw);
  alert("íšŒì›ê°€ì… ì™„ë£Œ!");
};

window.login = async function(){
  const email = document.getElementById("email").value;
  const pw = document.getElementById("pw").value;
  await signInWithEmailAndPassword(auth, email, pw);
  alert("ë¡œê·¸ì¸ ì„±ê³µ!");
};

async function loadLogs(){
  const snap = await getDocs(collection(db, "logs"));
  const list = document.getElementById("log");
  list.innerHTML = "";

  snap.forEach(docSnap => {
    const d = docSnap.data();
    const div = document.createElement("div");
    div.innerHTML = `
      <b>${d.nickname}</b> - ${d.roulette} (${d.count}íšŒ)
      <button onclick="removeLog('${docSnap.id}')">ì‚­ì œ(ê´€ë¦¬ìë§Œ)</button>
    `;
    list.appendChild(div);
  });
}

window.removeLog = async function(id){
  const user = auth.currentUser;
  if(!user){ alert("ë¡œê·¸ì¸ í•„ìš”"); return; }

  // Firestore Rulesì—ì„œ ê´€ë¦¬ìë§Œ í—ˆìš©ë¨
  try {
    await deleteDoc(doc(db, "logs", id));
    alert("ì‚­ì œ ì™„ë£Œ");
    loadLogs();
  } catch(e){
    alert("ê¶Œí•œ ì—†ìŒ(ê´€ë¦¬ì ì•„ë‹˜)");
  }
};

onAuthStateChanged(auth, (user)=>{
  if(user){
    document.getElementById("status").innerText = "ë¡œê·¸ì¸ë¨: " + user.email;
    loadLogs();
  } else {
    document.getElementById("status").innerText = "ë¯¸ë¡œê·¸ì¸";
  }
});
</script>

<style>
body{ font-family:Arial; background:#f0f0f0; padding:30px; }
.box{ background:white; padding:15px; border-radius:10px; margin-bottom:10px; }
</style>
</head>

<body>
<h1>ğŸ“Š ë£°ë › ë¡œê·¸</h1>

<div class="box">
  <div id="status">ë¯¸ë¡œê·¸ì¸</div>
  ì´ë©”ì¼ <input id="email"><br>
  ë¹„ë°€ë²ˆí˜¸ <input id="pw" type="password"><br>
  <button onclick="signup()">íšŒì›ê°€ì…</button>
  <button onclick="login()">ë¡œê·¸ì¸</button>
</div>

<div id="log"></div>

<p><a href="index.html">â† ë£°ë ›ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a></p>
</body>
</html>
