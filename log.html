<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë£°ë › ë¡œê·¸</title>
<style>
  body{margin:0;font-family:system-ui;background:#f4f5f7;}
  header{background:#fff;border-bottom:1px solid #ddd;padding:12px 16px;font-weight:900;}
  main{max-width:900px;margin:0 auto;padding:16px;}
  .box{background:#fff;border:1px solid #e5e5e5;border-radius:14px;padding:12px;margin-bottom:12px;}
  input{width:100%;box-sizing:border-box;margin:6px 0;padding:12px;border-radius:12px;border:1px solid #ddd;font-size:16px;}
  button{padding:12px 14px;border-radius:12px;border:none;background:#111;color:#fff;font-weight:900;margin-right:8px;}
  .secondary{background:#fff;color:#111;border:1px solid #ddd;}
  #err{display:none;white-space:pre-wrap;background:#fff5f5;border:1px solid #ffc9c9;color:#b00020;}
  #ok{display:none;white-space:pre-wrap;background:#f6fff7;border:1px solid #c9ffd1;color:#0a6b1e;}
</style>
</head>
<body>
<header>ğŸ“Š ë£°ë › ë¡œê·¸ (ì‘ê¸‰ ë””ë²„ê·¸)</header>
<main>
  <div id="err" class="box"></div>
  <div id="ok" class="box"></div>

  <div id="authBox" class="box">
    <div style="font-weight:900;margin-bottom:8px;">ë¡œê·¸ì¸</div>
    <input id="email" placeholder="ì´ë©”ì¼">
    <input id="pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button id="loginBtn">ë¡œê·¸ì¸</button>
    <button id="logoutBtn" class="secondary" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button>
  </div>

  <div id="info" class="box">ìƒíƒœ: ë¯¸ë¡œê·¸ì¸</div>
</main>

<script type="module">
  const err = document.getElementById("err");
  const ok = document.getElementById("ok");
  const info = document.getElementById("info");
  const authBox = document.getElementById("authBox");
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");

  function showErr(msg){ err.style.display="block"; err.textContent=String(msg); }
  function showOk(msg){ ok.style.display="block"; ok.textContent=String(msg); }

  window.addEventListener("error", (e)=>showErr("JS ì˜¤ë¥˜:\n" + (e.message || e.error)));
  window.addEventListener("unhandledrejection", (e)=>showErr("Promise ì˜¤ë¥˜:\n" + (e.reason?.message || e.reason)));

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  // âœ… ë„¤ ì„¤ì • ê·¸ëŒ€ë¡œ
  const firebaseConfig = {
    apiKey: "AIzaSyCgVETP2TbQOkDeh5D2ocwXhUMPcZYYKbs",
    authDomain: "roulette-b5455.firebaseapp.com",
    projectId: "roulette-b5455",
    storageBucket: "roulette-b5455.firebasestorage.app",
    messagingSenderId: "728191308035",
    appId: "1:728191308035:web:b14b46c38bbe0261969936"
  };

  showOk("ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì™„ë£Œ âœ…");

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  loginBtn.onclick = async ()=>{
    try{
      err.style.display="none"; ok.style.display="none";
      const email = document.getElementById("email").value.trim();
      const pw = document.getElementById("pw").value;
      showOk("ë¡œê·¸ì¸ ì‹œë„ì¤‘...");
      await signInWithEmailAndPassword(auth, email, pw);
      showOk("ë¡œê·¸ì¸ ì„±ê³µ!");
    }catch(e){
      showErr("ë¡œê·¸ì¸ ì‹¤íŒ¨:\n" + (e.code || "") + "\n" + (e.message || e));
    }
  };

  logoutBtn.onclick = async ()=>{ await signOut(auth); };

  onAuthStateChanged(auth, async (user)=>{
    if(!user){
      info.textContent = "ìƒíƒœ: ë¯¸ë¡œê·¸ì¸";
      logoutBtn.style.display="none";
      loginBtn.style.display="inline-block";
      return;
    }

    // âœ… ë¡œê·¸ì¸ ì„±ê³µí•˜ë©´ ì—¬ê¸°ì„œ UIDë¥¼ ë¬´ì¡°ê±´ í‘œì‹œ
    info.textContent = "ìƒíƒœ: ë¡œê·¸ì¸ë¨\nUID: " + user.uid + "\nEmail: " + (user.email || "");

    logoutBtn.style.display="inline-block";
    loginBtn.style.display="none";

    // ë‹‰ë„¤ì„ ì½ê¸° ì‹œë„(ì‹¤íŒ¨í•˜ë©´ ì—ëŸ¬ ë°•ìŠ¤ì— ëœ¸)
    try{
      const u = await getDoc(doc(db,"users", user.uid));
      if(u.exists()){
        info.textContent += "\nNickname: " + (u.data().nickname || "");
      }else{
        info.textContent += "\nNickname: (users ë¬¸ì„œ ì—†ìŒ)";
      }
    }catch(e){
      showErr("users ë‹‰ë„¤ì„ ì½ê¸° ì‹¤íŒ¨(ë£° ë˜ëŠ” ê¶Œí•œ ë¬¸ì œ ê°€ëŠ¥):\n" + (e.code||"") + "\n" + (e.message||e));
    }
  });
</script>

</body>
</html>
