<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë£°ë ›(ê´€ë¦¬ì ì „ìš©)</title>
<style>
  body{margin:0;font-family:system-ui,-apple-system,Arial;background:#f5f6f8;padding:18px;}
  .wrap{max-width:480px;margin:0 auto;display:flex;flex-direction:column;gap:12px;}
  .card{background:#fff;border:1px solid #e8e8e8;border-radius:16px;padding:14px;}
  h1{margin:0;font-size:20px;}
  .muted{color:#666;font-size:12px;line-height:1.4;margin-top:6px;}
  input{width:100%;box-sizing:border-box;padding:11px 12px;border:1px solid #ddd;border-radius:12px;font-size:14px;}
  .btn{width:100%;padding:11px 12px;border:none;border-radius:12px;background:#111;color:#fff;font-weight:900;cursor:pointer;margin-top:10px;}
  .btn.secondary{background:#fff;color:#111;border:1px solid #e8e8e8;}
  a{color:#2f6fed;text-decoration:none;font-weight:900;}
  .hidden{display:none;}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, doc, getDoc, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCgVETP2TbQOkDeh5D2ocwXhUMPcZYYKbs",
  authDomain: "roulette-b5455.firebaseapp.com",
  projectId: "roulette-b5455",
  storageBucket: "roulette-b5455.firebasestorage.app",
  messagingSenderId: "728191308035",
  appId: "1:728191308035:web:b14b46c38bbe0261969936"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const $ = (id)=>document.getElementById(id);

async function checkAdmin(uid){
  const s = await getDoc(doc(db,"admins",uid));
  return s.exists();
}

async function saveLog(rouletteName){
  const user = auth.currentUser;
  if(!user){ alert("ë¡œê·¸ì¸ì´ í•„ìš”í•´ìš”."); location.href="log.html"; return; }

  const nickname = $("nickname").value.trim();
  if(!nickname){ alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì¤˜"); return; }

  const count = Math.max(1, Number($("count").value || 1));

  // ğŸ”’ ì‹¤ì œë¡œëŠ” Rulesì—ì„œ ê´€ë¦¬ìë§Œ write ê°€ëŠ¥
  try{
    await addDoc(collection(db,"logs"), {
      uid: user.uid,
      nickname,
      roulette: rouletteName,
      count,
      createdAt: serverTimestamp()
    });
    alert("ì €ì¥ ì™„ë£Œ!");
  }catch(e){
    alert("ì €ì¥ ì‹¤íŒ¨(ê´€ë¦¬ì ê¶Œí•œ í•„ìš”): " + (e.code || e.message));
  }
}

window.spinBasic = ()=>saveLog("ì¼ë°˜ë£°ë ›");
window.spinNoble = ()=>saveLog("ê·€ì¡±ë£°ë ›");
window.spinTime  = ()=>saveLog("ì‹œê°„ë£°ë ›");

onAuthStateChanged(auth, async (user)=>{
  if(!user){
    $("notLogin").classList.remove("hidden");
    $("notAdmin").classList.add("hidden");
    $("adminOnly").classList.add("hidden");
    return;
  }
  const ok = await checkAdmin(user.uid);
  if(!ok){
    $("notLogin").classList.add("hidden");
    $("notAdmin").classList.remove("hidden");
    $("adminOnly").classList.add("hidden");
    return;
  }
  $("notLogin").classList.add("hidden");
  $("notAdmin").classList.add("hidden");
  $("adminOnly").classList.remove("hidden");
});
</script>
</head>
<body>

<div class="wrap">
  <div class="card">
    <h1>ğŸ¯ ë£°ë ›</h1>
    <div class="muted">ê´€ë¦¬ìë§Œ ë£°ë ›ì„ ëŒë¦´ ìˆ˜ ìˆì–´ìš”.</div>
    <div class="muted" style="margin-top:8px;"><a href="log.html">ğŸ“Š ê¸°ë¡ ì‚¬ì´íŠ¸ë¡œ ì´ë™</a></div>
  </div>

  <div id="notLogin" class="card hidden">
    <b>ë¡œê·¸ì¸ì´ í•„ìš”í•´ìš”.</b>
    <div class="muted">ë¡œê·¸ ì‚¬ì´íŠ¸ì—ì„œ ë¡œê·¸ì¸ í›„ ë‹¤ì‹œ ì™€ì¤˜.</div>
    <button class="btn" onclick="location.href='log.html'">ë¡œê·¸ ì‚¬ì´íŠ¸ë¡œ ê°€ê¸°</button>
  </div>

  <div id="notAdmin" class="card hidden">
    <b>ê´€ë¦¬ì ì „ìš© í˜ì´ì§€ì•¼.</b>
    <div class="muted">ì¼ë°˜ ìœ ì €ëŠ” ê¸°ë¡ ì‚¬ì´íŠ¸ë§Œ ì´ìš©í•  ìˆ˜ ìˆì–´.</div>
    <button class="btn" onclick="location.href='log.html'">ê¸°ë¡ ì‚¬ì´íŠ¸ë¡œ ê°€ê¸°</button>
  </div>

  <div id="adminOnly" class="card hidden">
    <b>ê´€ë¦¬ì ë£°ë › ì‹¤í–‰</b>
    <div class="muted">ë‹‰ë„¤ì„/íšŸìˆ˜ ì…ë ¥ í›„ ì›í•˜ëŠ” ë£°ë › ë²„íŠ¼ì„ ëˆŒëŸ¬ ì €ì¥í•´.</div>
    <div style="margin-top:10px;">ë‹‰ë„¤ì„</div>
    <input id="nickname" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" />
    <div style="margin-top:10px;">íšŸìˆ˜</div>
    <input id="count" type="number" min="1" value="1" />

    <button class="btn" onclick="spinBasic()">ì¼ë°˜ë£°ë › ì €ì¥</button>
    <button class="btn" onclick="spinNoble()">ê·€ì¡±ë£°ë › ì €ì¥</button>
    <button class="btn" onclick="spinTime()">ì‹œê°„ë£°ë › ì €ì¥</button>
  </div>
</div>

</body>
</html>
