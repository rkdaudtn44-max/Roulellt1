<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCgVETP2TbQOkDeh5D2ocwXhUMPcZYYKbs",
  authDomain: "roulette-b5455.firebaseapp.com",
  projectId: "roulette-b5455",
  storageBucket: "roulette-b5455.firebasestorage.app",
  messagingSenderId: "728191308035",
  appId: "1:728191308035:web:b14b46c38bbe0261969936"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

const emailEl = document.getElementById("email");
const pwEl = document.getElementById("pw");
const nickEl = document.getElementById("nick");
const msgEl = document.getElementById("msg");

function msg(t){ msgEl.textContent = t; }

document.getElementById("loginBtn").onclick = async ()=>{
  try{
    await auth.signInWithEmailAndPassword(
      emailEl.value.trim(),
      pwEl.value
    );
    location.href = "roulette.html";
  }catch(e){
    msg("로그인 실패: " + e.message);
  }
};

document.getElementById("signupBtn").onclick = async ()=>{
  try{
    const cred = await auth.createUserWithEmailAndPassword(
      emailEl.value.trim(),
      pwEl.value
    );

    await db.collection("users").doc(cred.user.uid).set({
      email: emailEl.value.trim(),
      nickname: nickEl.value.trim(),
      role: "user",
      xp: 0,
      level: 1,
      lottoTickets: 0,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    location.href = "roulette.html";
  }catch(e){
    msg("회원가입 실패: " + e.message);
  }
};

auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById("signedOut").style.display="none";
    document.getElementById("signedIn").style.display="block";
    document.getElementById("who").textContent = "로그인됨: " + user.email;
  }else{
    document.getElementById("signedOut").style.display="block";
    document.getElementById("signedIn").style.display="none";
  }
});

document.getElementById("logoutBtn").onclick = async ()=>{
  await auth.signOut();
};
</script>
